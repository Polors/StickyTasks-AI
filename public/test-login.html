<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>登录测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        button {
            padding: 10px 20px;
            margin: 10px 0;
        }

        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
        }

        .error {
            color: red;
        }

        .success {
            color: green;
        }
    </style>
</head>

<body>
    <h1>登录功能测试</h1>

    <div>
        <label>邮箱: <input type="email" id="email" value="admin@admin.com"></label><br>
        <label>密码: <input type="password" id="password" value="admin"></label><br>
        <button onclick="testLogin()">测试登录</button>
    </div>

    <h2>测试结果:</h2>
    <pre id="result"></pre>

    <script>
        async function testLogin() {
            const result = document.getElementById('result');
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            result.textContent = '正在测试...\n';

            try {
                console.log('Sending login request...');
                const res = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                result.textContent += `状态码: ${res.status}\n`;
                result.textContent += `Content-Type: ${res.headers.get('content-type')}\n\n`;

                const text = await res.text();
                result.textContent += `响应长度: ${text.length} 字符\n`;
                result.textContent += `响应内容:\n${text}\n\n`;

                if (!text) {
                    result.textContent += '❌ 错误: 服务器返回空响应\n';
                    result.className = 'error';
                    return;
                }

                try {
                    const data = JSON.parse(text);
                    result.textContent += '✅ JSON 解析成功!\n';
                    result.textContent += JSON.stringify(data, null, 2);
                    result.className = 'success';

                    if (data.token) {
                        localStorage.setItem('stickytasks-token', data.token);
                        result.textContent += '\n\n✅ Token 已保存到 localStorage';
                    }
                } catch (e) {
                    result.textContent += `❌ JSON 解析失败: ${e.message}\n`;
                    result.className = 'error';
                }
            } catch (error) {
                result.textContent += `❌ 请求失败: ${error.message}\n`;
                result.className = 'error';
                console.error('Login error:', error);
            }
        }
    </script>
</body>

</html>